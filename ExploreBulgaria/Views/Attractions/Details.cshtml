@model AttractionDetailsViewModel

<div class="cities-town" style="padding-top: 50px">
    <div class="container">
        <div class="row">
            <div class="slider-content">
                <div class="row">
                    <div class="col-lg-12">
                        <h2><em>@Model.Name</em></h2>
                        <div class="mb-3">
                            <span class="text-secondary">@Model.CategoryName ></span>
                            <span class="text-secondary">@Model.SubcategoryName ></span>
                            <span class="text-secondary">@Model.RegionName</span>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="owl-cites-town owl-carousel">
                            @foreach (var url in Model.ImageUrls)
                            {
                                <div class="item">
                                    <div class="thumb">
                                        <img src="@url" alt="">
                                    </div>
                                </div>
                            }                                               
                        </div>
                    </div>
                    <div class="card mb-0 mt-5">
                        <div class="card-body">
                            <p class="card-text" style="color: grey">
                                @Model.Description
                            </p>
                            <p class="card-text mt-5">
                                <div class="=row">
                                    <small class="text-secondary">Добавено от: </small>
                                    <small>
                                        <span>
                                            <img src="@Model.AddedByUser.AvatarUrl" class="autor-img rounded-circle mr-2" />
                                        </span> 
                                        <span class="text-primary">@Model.AddedByUser.FirstName @Model.AddedByUser.LastName</span>
                                    </small>
                                </div>
                            </p>
                        </div>
                    </div>                   
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container mt-5">
    <div class="row  d-flex justify-content-center">
        <div id="commentsContainer" class="col-md-8">
            <div class="headings d-flex justify-content-between align-items-center mb-3">
                <h5>Коментари</h5>
            </div>
            <div id="addComment" class="card p-3 mt-2">             
                <div class="row"> 
                    <form method="post">
                       <input id="attractionId" type="hidden" name="attractionId" value="@Model.Id" />
                       <textarea id="commentText" class="text-secondary col-lg-9" placeholder="Напиши коментар..."></textarea>
                       <button type="submit" onclick="addComment(event)" class="main-button col-lg-3" style="width: 115px; margin: 4px">Добави</button>
                    </form>
                </div>
            </div>
            @foreach (var comment in Model.Comments)
            {
                <div class="card p-3 mt-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="user d-flex flex-row align-items-center">
                            <img src="@comment.AddedByUser.AvatarUrl" class="user-img rounded-circle mr-2">
                            <div class="row">
                                <small class="font-weight-bold text-primary">@comment.AddedByUser.FirstName @comment.AddedByUser.LastName</small>
                                <small class="font-weight-bold text-secondary">@comment.Text</small>
                            </div>
                        </div>
                        <small class="text-secondary">@comment.CreatedOn.ToShortDateString()</small>
                    </div>
                    <div class="action d-flex justify-content-between mt-2 align-items-center">
                        <div class="reply px-4">
                            <small>Remove</small>
                            <span class="dots"></span>
                            <small>Reply</small>                                                 
                        </div>
                        <div class="d-flex flex-row align-items-center">
                            <p class="small text-muted mb-0">Харесай</p>
                            <i class="far fa-thumbs-up mx-2 fa-xs text-black"></i>
                            <p class="small text-muted mb-0">3</p>
                        </div>
                        <div class="icons align-items-center">
                            <i class="fa fa-check-circle-o check-icon text-primary"></i>
                        </div>
                    </div>
                </div>
            }           
        </div>
    </div>
</div>

@section Links {
    <link rel="stylesheet" href="~/css/comments.css" />
}

@section Scripts {
    <script>
        addComment = function (event) {
            event.preventDefault();
            const attractionId = $('#attractionId').val();
            const text = $('#commentText').val();
            const antiForgeryToken = $('input[name=__RequestVerificationToken]').val();

            fetch('/api/CommentsApi/comments', {
                method: 'POST',
                headers: {
                    'X-CSRF-TOKEN': antiForgeryToken,
                    'content-type': 'application/json'
                },
                body: JSON.stringify({ attractionId, text })
            })
                .then(result => result.json())
                .then(data => {
                    var element = document.createElement('div');
                    element.setAttribute('class', 'card p-3 mt-2');
                    element.innerHTML = 
                    `<div class="d-flex justify-content-between align-items-center">
                        <div class="user d-flex flex-row align-items-center">
                            <img src="${data.addedByUser.avatarUrl}" class="user-img rounded-circle mr-2">
                            <div class="row">
                                <small class="font-weight-bold text-primary">${data.addedByUser.firstName} ${data.addedByUser.lastName}</small>
                                <small class="font-weight-bold text-secondary">${data.text}</small>
                            </div>
                        </div>
                        <small class="text-secondary">${new Date(data.createdOn).toLocaleDateString()}</small>
                    </div>
                    <div class="action d-flex justify-content-between mt-2 align-items-center">
                        <div class="reply px-4">
                            <small>Remove</small>
                            <span class="dots"></span>
                            <small>Reply</small>
                        </div>
                        <div class="d-flex flex-row align-items-center">
                            <p class="small text-muted mb-0">Харесай</p>
                            <i class="far fa-thumbs-up mx-2 fa-xs text-black"></i>
                            <p class="small text-muted mb-0">3</p>
                        </div>
                        <div class="icons align-items-center">
                            <i class="fa fa-check-circle-o check-icon text-primary"></i>
                        </div>
                    </div>`;

                    document.getElementById('addComment').after(element);

                    $('#commentText').val('');
                })
        }       
    </script>
}

